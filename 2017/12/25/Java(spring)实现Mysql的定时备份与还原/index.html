<!DOCTYPE html>
<!--[if lte IE 8 ]>
<html class="ie" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<![endif]-->
<!--[if (gte IE 9)|!(IE)]><!-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-CN" lang="zh-CN">
<!--<![endif]-->

<head>
  <title>Java(spring)实现Mysql的定时备份与还原 | ZY&#39;s Blog</title>
  <!-- Meta data -->
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="ZY's Blog">
    <meta name="author" content="Z Yong">
    <meta name="description" content="Young for you." />
    <meta name="keywords" content="" />

    <!-- Favicon, (keep icon in root folder) -->
    <link rel="Shortcut Icon" href="/img/favicon.ico" type="image/ico">

    <link rel="alternate" href="/atom.xml" title="ZY&#39;s Blog" type="application/atom+xml">
    <link rel="stylesheet" href="/css/all.css" media="screen" type="text/css">
    
    <link rel="stylesheet" href="/highlightjs/vs.css" type="text/css">
    

    <!--[if IE 8]>
    <link rel="stylesheet" type="text/css" href="/css/ie8.css" />
    <![endif]-->

    <!-- jQuery | Load our jQuery, with an alternative source fallback to a local version if request is unavailable -->
    <script src="/js/jquery-1.11.1.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/jquery-1.11.1.min.js"><\/script>')</script>

    <!-- Load these in the <head> for quicker IE8+ load times -->
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="/js/html5shiv.min.js"></script>
    <script src="/js/respond.min.js"></script>
    <![endif]-->

  
  
  <link rel="alternate" type="application/atom+xml" title="Atom 0.3" href="atom.xml">
  
  

  <style>.col-md-8.col-md-offset-2.opening-statement img{display:none;}</style>
</head>

<!--
<body class="post-template">
-->
<body id="index" class="lightnav animsition">

      <!-- ============================ Off-canvas navigation =========================== -->

    <div class="sb-slidebar sb-right sb-style-overlay sb-momentum-scrolling">
        <div class="sb-close" aria-label="Close Menu" aria-hidden="true">
            <img src="/img/close.png" alt="Close"/>
        </div>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu">
            <li><a href="/" class="animsition-link" title="Home">Home</a></li>
            <li><a href="/archives" class="animsition-link" title="archive">archives</a></li>
            <!-- Dropdown Menu -->
			 
            
        	<li>
        		<a class="sb-toggle-submenu">Categories<span class="sb-caret"></span></a>
            	<ul class="sb-submenu">
				  	
				    <li><a href="/categories/技术/" class="animsition-link">技术<small>(35)</small></a></li>
				    
				    <li><a href="/categories/芭乐/" class="animsition-link">芭乐<small>(1)</small></a></li>
				    
				</ul>
        	</li>
			
            
        </ul>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu secondary">
            
            <li><a href="/about.html" class="animsition-link" title="about">About</a></li>
            <li><a href="/tagcloud.html" class="animsition-link" title="rss">tagcloud</a></li>
        </ul>
    </div>
    
    <!-- ============================ END Off-canvas navigation =========================== -->

    <!-- ============================ #sb-site Main Page Wrapper =========================== -->

    <div id="sb-site">
        <!-- #sb-site - All page content should be contained within this id, except the off-canvas navigation itself -->

        <!-- ============================ Header & Logo bar =========================== -->

        <div id="navigation" class="navbar navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <!-- Nav logo -->
                    <div class="logo">
                        <a href="/" title="Logo" class="animsition-link">
                         <img src="/img/logo.png" alt="Logo" width="35px;"/> 
                        </a>
                    </div>
                    <!-- // Nav logo -->
                    <!-- Info-bar -->
                    <nav>
                        <ul class="nav">
                            <li><a href="/" class="animsition-link">ZY's Blog</a></li>
                            <li class="nolink"><span>Always </span>Creative.</li>
                            
                            <li><a href="https://github.com/" title="Github" target="_blank"><i class="icon-github"></i></a></li>
                            
                            
                            <li><a href="https://twitter.com/" title="Twitter" target="_blank"><i class="icon-twitter"></i></a></li>
                            
                            
                            <li><a href="https://www.facebook.com/" title="Facebook" target="_blank"><i class="icon-facebook"></i></a></li>
                            
                            
                            <li><a href="https://google.com/" title="Google-Plus" target="_blank"><i class="icon-google-plus"></i></a></li>
                            
                            
                            <li><a href="http://weibo.com/" title="Sina-Weibo" target="_blank"><i class="icon-sina-weibo"></i></a></li>
                            
                            <li class="nolink"><span>Welcome!</span></li>
                        </ul>
                    </nav>
                    <!--// Info-bar -->
                </div>
                <!-- // .container -->
                <div class="learnmore sb-toggle-right">More</div>
                <button type="button" class="navbar-toggle menu-icon sb-toggle-right" title="More">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar before"></span>
                <span class="icon-bar main"></span>
                <span class="icon-bar after"></span>
                </button>
            </div>
            <!-- // .navbar-inner -->
        </div>

        <!-- ============================ Header & Logo bar =========================== -->


      
<section id="intro">
    <div class="container">
        <div class="row col-md-offset-2">
            <div class="col-md-8">
    			<span class="post-meta">
      <time datetime="2017-12-25T11:23:12.000Z" itemprop="datePublished">
          2017-12-25
      </time>
    
    
    | 
    <a href='/tags/spring定时任务/'>spring定时任务</a>,
    
    <a href='/tags/Mysql备份还原/'>Mysql备份还原</a>
    
    
</span>
                <h1>Java(spring)实现Mysql的定时备份与还原</h1>
            </div>
        </div>
        <div class="col-md-8 col-md-offset-2">
      		<h3 id="一、数据库的定时备份"><a href="#一、数据库的定时备份" class="headerlink" title="一、数据库的定时备份"></a>一、数据库的定时备份</h3><h4 id="备份命令"><a href="#备份命令" class="headerlink" title="备份命令"></a>备份命令</h4><p>Mysql的备份指令：</p>
<ol>
<li>指定数据库：<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysqldump -h localhost -uroot -proot  tuser&gt;d:\user_2017-12-25_15-42-10.sql</div></pre></td></tr></table></figure>
</li>
</ol>
<p>tuser：数据库名<br>user_2017-12-25_15-42-10.sql：文件名</p>
<ol>
<li>指定数据库中的多个表：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysqldump -h localhost -uroot -proot --databases tuser --tables t_user t_user2&gt;d:\user_2017-12-25_15-42-two.sql</div></pre></td></tr></table></figure>
<p>在 –tables 之后加上所需备份的表名</p>
<h4 id="定时（Spring-Task）"><a href="#定时（Spring-Task）" class="headerlink" title="定时（Spring-Task）"></a>定时（Spring-Task）</h4><p>了解了mysql的备份命令，那么如何实现定时呢？<br><strong>这里采用Spring的定时任务来实现，基于注解的方式。</strong></p>
<p>主要有两点注意：</p>
<h5 id="1-Spring-xml中开启定时任务注解的配置："><a href="#1-Spring-xml中开启定时任务注解的配置：" class="headerlink" title="1. Spring.xml中开启定时任务注解的配置："></a>1. Spring.xml中开启定时任务注解的配置：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"> &lt;!--开启定时任务注解--&gt;</div><div class="line">&lt;task:annotation-driven /&gt;</div></pre></td></tr></table></figure>
<p>注意在头部引入task的标签及描述</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">xmlns:task=&quot;http://www.springframework.org/schema/task&quot;</div><div class="line">http://www.springframework.org/schema/task</div><div class="line">http://www.springframework.org/schema/task/spring-task-4.0.xsd</div></pre></td></tr></table></figure>
<h5 id="2-在相应的方法中添加注解-Scheduled"><a href="#2-在相应的方法中添加注解-Scheduled" class="headerlink" title="2.在相应的方法中添加注解@Scheduled"></a>2.在相应的方法中添加注解@Scheduled</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">@Scheduled(cron=&quot;0/5 * *  * * ? &quot;)   //每5秒执行一次</div><div class="line">public void task1()&#123;</div><div class="line">    System.out.println(&quot;北京时间：&quot;+new Date());</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>注意(cron=”0/5 <em> </em>  <em> </em> ? “)  表达式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">cron=&quot;0/5 * *  * * ? &quot;   表示每隔5s执行一次</div><div class="line">cron=&quot; * * 0/1 * * ? &quot;   表示每隔1小时执行一次</div><div class="line"></div><div class="line">关于cronExpression的配置可以百度</div></pre></td></tr></table></figure>
<p>对数据库  tuser  中的两张表 t_user 和 t_user2 进行备份:<br>代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">//定时备份方案</div><div class="line">   @Scheduled(cron=&quot;0/5 * *  * * ? &quot;)   //每5秒执行一次  @Scheduled(cron=&quot; * * 0/1 * * ? &quot;) 每小时一次</div><div class="line">   public void back()&#123;</div><div class="line">       System.out.println(&quot;现在时间是&quot;+new Date());</div><div class="line">       Runtime runtime = Runtime.getRuntime();  //获取Runtime实例</div><div class="line">       String user = &quot;root&quot;;</div><div class="line">       String password = &quot;root&quot;;</div><div class="line">       String database1 = &quot;tuser&quot;; // 需要备份的数据库名</div><div class="line">       String table1 = &quot;t_user&quot;;</div><div class="line">       String table2 = &quot;t_user2&quot;;</div><div class="line">       Date currentDate = new Date();</div><div class="line">       SimpleDateFormat sdf = new SimpleDateFormat(&quot;yyyy-MM-dd_HH-mm-ss&quot;);</div><div class="line">       String sdfDate = sdf.format(currentDate);</div><div class="line">       String filepath = &quot;d:\\time_&quot; + sdfDate + &quot;.sql&quot;; // 备份的路径地址</div><div class="line">       //执行命令</div><div class="line">       String stmt = &quot;mysqldump  -h localhost -u &quot;+user+&quot; -p&quot;+password+&quot; --databases &quot;+database1+&quot; --tables &quot;+table1+&quot; &quot;+table2 +&quot; &gt; &quot;+filepath;   </div><div class="line">       System.out.println(stmt);</div><div class="line">       try &#123;</div><div class="line">           String[] command = &#123; &quot;cmd&quot;, &quot;/c&quot;, stmt&#125;;</div><div class="line">           Process process = runtime.exec(command);</div><div class="line">           InputStream input = process.getInputStream();</div><div class="line">           System.out.println(IOUtils.toString(input, &quot;UTF-8&quot;));</div><div class="line">           //若有错误信息则输出</div><div class="line">           InputStream errorStream = process.getErrorStream();</div><div class="line">           System.out.println(IOUtils.toString(errorStream, &quot;UTF-8&quot;));</div><div class="line">       &#125; catch (IOException e) &#123;</div><div class="line">           e.printStackTrace();</div><div class="line">       &#125;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<h3 id="二、数据库的还原"><a href="#二、数据库的还原" class="headerlink" title="二、数据库的还原"></a>二、数据库的还原</h3><h4 id="还原命令"><a href="#还原命令" class="headerlink" title="还原命令"></a>还原命令</h4><p>可以通过两种方式来进行还原操作。</p>
<h5 id="1-mysql-利用sql文件还原数据库"><a href="#1-mysql-利用sql文件还原数据库" class="headerlink" title="1. mysql 利用sql文件还原数据库"></a>1. mysql 利用sql文件还原数据库</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysql -h localhost -uroot -proot tuser&lt; D:\user_2017-12-25_15-42-10.sql</div></pre></td></tr></table></figure>
<h5 id="2-source-命令"><a href="#2-source-命令" class="headerlink" title="2. source 命令"></a>2. source 命令</h5><p>这也是导入sql文件的方式，登录mysql之后，输入：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">source d:/game_product2018-01-02_10-41-30.sql</div></pre></td></tr></table></figure></p>
<p>注意反斜杠的方向，“source d:\ab.sql” 这样会执行失败。<br><strong>注：在Navicat中无法使用 source 命令</strong></p>
<h4 id="还原"><a href="#还原" class="headerlink" title="还原"></a>还原</h4><p>在代码中采用第一种方式实现还原操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">public void restore() &#123;</div><div class="line">    String user = &quot;root&quot;;</div><div class="line">    String password = &quot;root&quot;;</div><div class="line">    String database = &quot;tuser&quot;; // 需要备份的数据库名</div><div class="line">    System.out.println(&quot;现在时间是&quot; + new Date());</div><div class="line">    Runtime runtime = Runtime.getRuntime();</div><div class="line"></div><div class="line">    String cmd = &quot;mysql  -h localhost&quot; + &quot; -u &quot; + user + &quot; -p&quot; + password + &quot; &quot; + database;</div><div class="line">    System.out.println(cmd);</div><div class="line">    try &#123;</div><div class="line">        String filePath =  &quot;D:\\user_2017-12-25_15-42-10.sql&quot;; // sql文件路径</div><div class="line">        String stmt = cmd + &quot; &lt; &quot; + filePath;</div><div class="line">        String[] command = &#123;&quot;cmd&quot;, &quot;/c&quot;, stmt&#125;;</div><div class="line">        Process process = runtime.exec(command);</div><div class="line">        //若有错误信息则输出</div><div class="line">        InputStream errorStream = process.getErrorStream();</div><div class="line">        System.out.println(IOUtils.toString(errorStream, &quot;utf-8&quot;));</div><div class="line">        //等待操作</div><div class="line">        int processComplete = process.waitFor();</div><div class="line">        if (processComplete == 0) &#123;</div><div class="line">            System.out.println(&quot;还原成功.&quot;);</div><div class="line">        &#125; else &#123;</div><div class="line">            throw new RuntimeException(&quot;还原数据库失败.&quot;);</div><div class="line">        &#125;</div><div class="line">    &#125; catch (Exception e) &#123;</div><div class="line">        e.printStackTrace();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

            <div class="clearfix"></div>
            <hr class="nogutter">
        </div>
        <nav class="m-pagination col-md-8 col-md-offset-2 col-sm-24" role="pagination">
    
    <a class="pull-left" href="/2018/01/07/Map 的4种遍历方式及比较/" style="float: left;">
        ← Map 的4种遍历方式及比较
    </a>
    
    
    <a class="pull-right" href="/2017/12/18/中缀表达式转后缀表达式（逆波兰）/">
        中缀表达式转后缀表达式（逆波兰） →
    </a>
    
</nav>

        <div class="col-md-8 col-md-offset-2 col-sm-24"><script type="text/javascript">
  /**
   * 搜狐畅言
   */

  /*
  document.write('<div id="SOHUCS" sid="' + window.location.pathname.slice(1) + '" ></div>');

  window.onload = function () {
    (function () {
      var appid = 'cytXXXX';
      var conf = 'prod_xxxxxxxxxxxxxxxxx';
      var width = window.innerWidth || document.documentElement.clientWidth;
      var loadJs = function (d, a, id) {
        var c = document.getElementsByTagName("head")[0] || document.head || document.documentElement;
        var b = document.createElement("script");
        b.setAttribute("type", "text/javascript");
        b.setAttribute("charset", "UTF-8");
        b.setAttribute("src", d);
        if (id) {
          b.setAttribute("id", id);
        }
        if (typeof a === "function") {
          if (window.attachEvent) {
            b.onreadystatechange = function () {
              var e = b.readyState;
              if (e === "loaded" || e === "complete") {
                b.onreadystatechange = null;
                a()
              }
            }
          } else {
            b.onload = a
          }
        }
        c.appendChild(b)
      };

      loadJs("https://changyan.sohu.com/upload/changyan.js", function () {
        window.changyan.api.config({
          appid: appid,
          conf: conf
        })
      });
    })();
  }
  */

</script>
</div>
    </div>
</section>


      
<!-- ============================ Footer =========================== -->

<footer>
    <div class="container">
            <div class="copy">
                <p>
                    &copy; 2014<script>new Date().getFullYear()>2010&&document.write("-"+new Date().getFullYear());</script>, Content By Z Yong. All Rights Reserved.
                </p>
                <p>Theme By <a href="//go.kieran.top" style="color: #767D84">Kieran</a></p>
            </div>
            <div class="social">
                <ul>
                    
                    <li><a href="https://github.com/" title="Github" target="_blank"><i class="icon-github"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="https://twitter.com/" title="Twitter" target="_blank"><i class="icon-twitter"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="https://www.facebook.com/" title="Facebook" target="_blank"><i class="icon-facebook"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="https://google.com/" title="Google-Plus" target="_blank"><i class="icon-google-plus"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="http://weibo.com/" title="Sina-Weibo" target="_blank"><i class="icon-sina-weibo"></i></a>&nbsp;</li>
                    
                </ul>
            </div>
            <div class="clearfix"> </div>
        </div>
</footer>

<!-- ============================ END Footer =========================== -->
      <!-- Load our scripts -->
<!-- Resizable 'on-demand' full-height hero -->
<script type="text/javascript">
    var resizeHero = function () {
        var hero = $(".cover,.heightblock"),
            window1 = $(window);
        hero.css({
            "height": window1.height()
        });
    };

    resizeHero();

    $(window).resize(function () {
        resizeHero();
    });
</script>
<script src="/js/plugins.min.js"></script><!-- Bootstrap core and concatenated plugins always load here -->
<script src="/js/scripts.js"></script><!-- Theme scripts -->


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$('#intro').find('img').each(function(){
  var alt = this.alt;

  if (alt){
    $(this).after('<span class="caption" style="display:none">' + alt + '</span>');
  }

  $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="gallery" />');
});
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



      
</body>
</html>
